# 프로젝트 상태 보고서: LnxTerm (Project Status)

> **현재 버전**: v1.8.0
> **최종 업데이트**: 2026-02-13
> **타겟 시스템**: Linux (ST-Link V3 Mini 디버깅 환경)

## 1. AI 에이전트를 위한 프로젝트 개요
이 문서는 다음 개발 세션에서 **AI가 프로젝트의 현재 상태를 즉시 복원**하고 작업을 이어갈 수 있도록 핵심 아키텍처, 구현 세부 사항, 운영 요구 사항을 요약한 것입니다. 전체 대화 내역을 다시 읽지 않아도 이 문서 하나로 개발 흐름을 파악할 수 있습니다.

## 2. 기술 스택 (Technical Stack)
- **언어**: Python 3.12+
- **GUI 프레임워크**: PyQt6 (VS Code Dark+ 테마 적용 - `styles.py`)
- **시리얼 통신**: `pyserial` (커널 레벨 배타적 접근 `TIOCEXCL` 적용)
- **배포 및 빌드**: `PyInstaller` (리눅스용 단독 실행 파일 생성)
- **버전 관리**: Git + GitHub CLI (`gh`)를 통한 릴리스 자동화

## 3. 핵심 아키텍처 및 주요 파일
- **진입점 (Entry Point)**: `main.py` -> `main_window.py` (MainWindow 초기화)
- **시리얼 로직**: `serial_manager.py` (스레드 기반 비동기 수신, 자동 포트 스캔 및 점유 감지)
    - *중요*: `QThread`를 사용하여 UI 블로킹 없이 데이터를 수신함.
    - *중요*: **Lockfile** (`/var/lock/LCK..*`), `fuser`, `lsof`를 통해 `check_port_in_use()` 구현.
- **UI 컴포넌트**:
    - `sidebar_widget.py`: 포트 설정, 상단 아이콘 액션 버튼, **로그 파일 경로/시작 시각 표시**, 문자열 찾기 카운터.
    - `terminal_widget.py`: `QPlainTextEdit` 기반, **타임스탬프 삽입** 및 ANSI 컬러 처리 (시스템 메시지: 파랑/초록).
    - `search_widget.py`: 터미널 내 텍스트 검색 및 이동(Next/Prev) 기능.
- **설정 관리**: `.env` (사용자별 `LOG_DIR` 지정), `.env.example` (템플릿).

## 4. 기능 구현 현황 (v1.8.0 완료)

### A. 시리얼 통신 및 포트 관리 [완료]
- **연결**: 표준 보레이트 지원. `exclusive=True` (TIOCEXCL) 옵션으로 커널 레벨에서 다른 프로세스의 접근 차단.
- **포트 감지**:
    - `/dev/ttyACM*`, `/dev/ttyUSB*` 스캔.
    - **충돌 감지 및 경고**: 연결 시도 전, 해당 포트를 점유 중인 프로세스 확인.
      - **메커니즘**: `/var/lock/LCK..tty*` 확인 및 `fuser`/`lsof` 실행.
      - **동작**: 점유 중일 경우 경고 다이얼로그(PID, 프로세스명 표시) 출력.
- **자동 재연결**: 연결 끊김 시 3초마다 자동 재연결 시도. (재연결 시에는 터미널에 조용히 경고 출력).

### B. 로그 시스템 [완료]
- **저장 경로**: `.env`의 `LOG_DIR` 설정값 사용. 미설정 시 최초 실행 때 다이얼로그로 선택.
- **파일명 규칙**: `lnxterm_YYYYMMDD_HHMMSS.log` (자동 생성).
- **편의성 (UX)**: 사이드바에 현재 로그 파일의 **절대 경로**를 표시. 마우스로 드래그 및 선택이 가능하여(`TextSelectableByMouse`), 복사 후 다른 터미널에서 사용하기 용이함.
- **경로 정합성**: 사이드바 표시 경로가 실제 생성 파일 절대 경로와 일치하도록 수정.

### C. 사이드바 UX/운영 개선 (v1.8.0) [완료]
- **분할 리사이즈**: 사이드바(좌)와 터미널(우)을 `QSplitter`로 구성해 마우스로 너비 조절 가능.
- **연결 설정 안정화**: 소형 창에서 겹치던 포트/Baud/Data/Parity/Stop 입력을 `QGridLayout` 기반으로 정리.
- **아이콘 액션 버튼**: 연결/해제, 터미널 클리어를 상단 아이콘 버튼으로 재배치.
- **문자열 찾기 카운터**:
  - 최대 10개 문자열 등록.
  - 로그 출력 매칭 시 항목별 누적 카운트 증가.
  - 첫 매칭 시각을 시작 시각으로 저장/표시.
  - 항목별 초기화 아이콘으로 카운트와 시작 시각 리셋.

### D. 배포 및 운영 [완료]
- **빌드 스크립트**: `build_exe.sh` (환경 검증 후 PyInstaller 실행).
- **산출물**: `dist/lnxterm` (단독 실행 가능한 리눅스 바이너리).
- **다중 인스턴스**: 싱글톤 제한 없음. `./lnxterm & ./lnxterm &` 형태로 여러 창을 동시에 띄워 서로 다른 포트 모니터링 가능.

## 5. 개발 가이드라인
1. **로컬 실행**:
   ```bash
   source .venv/bin/activate
   python main.py
   # 다중 실행 테스트 시:
   python main.py & python main.py &
   ```
2. **빌드 및 배포**:
   ```bash
   ./build_exe.sh  # 결과물: dist/lnxterm
   ```
3. **보안 규칙**:
   - **`.env` 파일은 절대 커밋하지 않음.**
   - `.gitignore` 및 `.antigravityignore`에 민감한 파일이 등록되어 있음.

## 6. 최근 컨텍스트 (Session History)
- **v1.7**: 포트 점유 감지 기능 강화 (Lockfile + Process 확인 + TIOCEXCL).
- **v1.7.1**: `pyserial` 연결 시 `exclusive=True` 강제 적용.
- **v1.7.2**: 사이드바 UI 개선 (로그 파일 절대 경로 표시 및 텍스트 선택/복사 기능 추가).
- **v1.8.0**: 문자열 찾기 카운터/시작 시각/초기화, 연결 설정 레이아웃 안정화, 좌우 리사이즈, 상단 아이콘 버튼 도입.

## 7. 향후 과제 (Next Steps)
- [ ] **고급 필터링**: `TerminalWidget`에 정규식(Regex) 기반 라인 필터링 기능 추가.
- [ ] **매크로/스크립팅**: 자주 사용하는 명령어 시퀀스 저장 및 전송 기능.
- [ ] **Hex 뷰**: 바이너리 데이터 디버깅을 위한 Hex 덤프 뷰 모드 구현.
