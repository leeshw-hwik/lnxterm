"""
Application-level lightweight i18n helpers.
"""

from __future__ import annotations

SUPPORTED_LANGUAGES = {"ko", "en"}


def normalize_language(language: str | None) -> str:
    if not language:
        return "ko"
    language = language.lower().strip()
    return language if language in SUPPORTED_LANGUAGES else "ko"


TRANSLATIONS = {
    "ko": {
        "app.title": "LnxTerm - ì‹œë¦¬ì–¼ í„°ë¯¸ë„",
        "command.placeholder": "ëª…ë ¹ì„ ì…ë ¥í•˜ì„¸ìš”... (Enterë¡œ ì „ì†¡)",
        "menu.file": "íŒŒì¼(&F)",
        "menu.edit": "í¸ì§‘(&E)",
        "menu.view": "ë³´ê¸°(&V)",
        "menu.help": "ë„ì›€ë§(&H)",
        "menu.language": "ì–¸ì–´",
        "action.log_start": "ë¡œê·¸ ì‹œì‘...",
        "action.log_stop": "ë¡œê·¸ ì¤‘ì§€",
        "action.update_env": "í™˜ê²½ ë³€ìˆ˜ ì—…ë°ì´íŠ¸",
        "action.exit": "ì¢…ë£Œ(&X)",
        "action.find": "ê²€ìƒ‰(&F)",
        "action.clear_terminal": "í„°ë¯¸ë„ í´ë¦¬ì–´",
        "action.toggle_sidebar": "ì‚¬ì´ë“œë°” í† ê¸€",
        "action.refresh_ports": "í¬íŠ¸ ìƒˆë¡œê³ ì¹¨",
        "action.about": "LnxTerm ì •ë³´",
        "action.lang_ko": "í•œêµ­ì–´",
        "action.lang_en": "English",
        "button.send": "ì „ì†¡",
        "status.disconnected": "âš« ì—°ê²° ì•ˆë¨",
        "status.connected": "ğŸŸ¢ ì—°ê²°ë¨",
        "status.reconnecting": "ğŸŸ¡ ì¬ì—°ê²° ëŒ€ê¸°",
        "msg.app_started": "LnxTerm ì‹œë¦¬ì–¼ í„°ë¯¸ë„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.",
        "msg.log_dir": "ë¡œê·¸ ë””ë ‰í† ë¦¬: {path}",
        "msg.log_dir_not_set": "ë¡œê·¸ ë””ë ‰í† ë¦¬ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì—°ê²° ì‹œ ì„¤ì •í•©ë‹ˆë‹¤.",
        "msg.reconnect_interval": "ìë™ ì¬ì—°ê²° ê°„ê²©: {interval}",
        "msg.env_path": ".env ê²½ë¡œ: {path}",
        "msg.select_port": "ì‚¬ì´ë“œë°”ì—ì„œ í¬íŠ¸ë¥¼ ì„ íƒí•˜ê³  ì—°ê²°í•˜ì„¸ìš”.\n",
        "msg.port_in_use_warning_terminal": "âš ï¸  ê²½ê³ : {port} ê°€ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤:\n{procs}\n",
        "dialog.port_in_use.title": "í¬íŠ¸ ì‚¬ìš© ì¤‘",
        "dialog.port_in_use.body": "{port} í¬íŠ¸ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤:\n\n{procs}\n\nê·¸ë˜ë„ ì—°ê²°ì„ ì‹œë„í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
        "msg.connect_canceled": "ì—°ê²° ì·¨ì†Œë¨.\n",
        "msg.connected": "ì—°ê²°ë¨: {port} @ {baudrate} bps\n",
        "dialog.connect_error.title": "ì—°ê²° ì˜¤ë¥˜",
        "dialog.connect_error.body": "ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:\n{error}",
        "msg.connect_failed": "ì—°ê²° ì‹¤íŒ¨: {error}\n",
        "dialog.select_log_dir": "ë¡œê·¸ ì €ì¥ ë””ë ‰í† ë¦¬ ì„ íƒ",
        "msg.log_dir_required": "ë¡œê·¸ ë””ë ‰í† ë¦¬ë¥¼ ì§€ì •í•´ì•¼ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n",
        "msg.log_dir_set": "ë¡œê·¸ ë””ë ‰í† ë¦¬ ì„¤ì •: {path}\n",
        "time.seconds.integer": "{value}ì´ˆ",
        "time.seconds.float": "{value:g}ì´ˆ",
        "msg.disconnected": "ì—°ê²° í•´ì œ: {port}\n",
        "msg.auto_reconnect_after": "{delay} í›„ ìë™ ì¬ì—°ê²° ì‹œë„...\n",
        "msg.reconnect_trying": "ì¬ì—°ê²° ì‹œë„ ì¤‘...\n",
        "msg.reconnect_failed": "ì¬ì—°ê²° ì‹¤íŒ¨, {delay} í›„ ë‹¤ì‹œ ì‹œë„...\n",
        "msg.error_prefix": "ì˜¤ë¥˜: {error}\n",
        "msg.port_not_connected": "í¬íŠ¸ê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n",
        "msg.send_error": "ì „ì†¡ ì˜¤ë¥˜: {error}\n",
        "msg.send_error_delayed": "ì „ì†¡ ì˜¤ë¥˜ (ì§€ì—° ì „ì†¡): {error}\n",
        "msg.log_start": "ë¡œê·¸ ê¸°ë¡ ì‹œì‘: {path}\n",
        "dialog.log_error.title": "ë¡œê·¸ ì˜¤ë¥˜",
        "dialog.log_error.body": "ë¡œê·¸ íŒŒì¼ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:\n{error}",
        "msg.log_stop": "ë¡œê·¸ ê¸°ë¡ ì¢…ë£Œ: {path}\n",
        "msg.terminal_cleared": "í„°ë¯¸ë„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\n",
        "about.title": "LnxTerm ì •ë³´",
        "about.body": (
            "<h3>LnxTerm ì‹œë¦¬ì–¼ í„°ë¯¸ë„</h3>"
            "<p>ë²„ì „: {version}</p>"
            "<p>ST-Link V3 Mini ê¸°ë°˜ ì„ë² ë””ë“œ ì¥ì¹˜<br>"
            "ë””ë²„ê·¸ ë° ë¡œê·¸ ìˆ˜ì§‘ì„ ìœ„í•œ ì‹œë¦¬ì–¼ í„°ë¯¸ë„</p>"
            "<p><b>ê¸°ëŠ¥:</b></p>"
            "<ul>"
            "<li>ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²° ë° ëª…ë ¹ ì „ì†¡</li>"
            "<li>ë°€ë¦¬ì´ˆ íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨ ë¡œê·¸ ê¸°ë¡</li>"
            "<li>í„°ë¯¸ë„ ì¶œë ¥ ê²€ìƒ‰</li>"
            "</ul>"
        ),
        "msg.env_updated": "í™˜ê²½ ë³€ìˆ˜(.env)ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.\n",
        "dialog.done.title": "ì™„ë£Œ",
        "dialog.done.body": "í™˜ê²½ ë³€ìˆ˜(.env)ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.",
        "dialog.update_unavailable.title": "ì—…ë°ì´íŠ¸ ë¶ˆê°€",
        "dialog.update_unavailable.body": "AUTO_LOAD_MODEê°€ '{mode}'ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
        "dialog.failed.title": "ì‹¤íŒ¨",
        "dialog.failed.body": "í™˜ê²½ ë³€ìˆ˜ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜)",
        "search.placeholder": "ê²€ìƒ‰...",
        "search.tooltip.prev": "ì´ì „ ê²°ê³¼ (Shift+F3)",
        "search.tooltip.next": "ë‹¤ìŒ ê²°ê³¼ (F3)",
        "search.tooltip.close": "ë‹«ê¸° (Esc)",
        "search.no_results": "ê²°ê³¼ ì—†ìŒ",
        "automation.title": "ìë™ ëª…ë ¹ ì„¤ì •",
        "automation.group.basic": "ìë™ ëª…ë ¹ ê¸°ë³¸ ì •ë³´",
        "automation.group.pre": "ì‚¬ì „ ëª…ë ¹ (ì‹œì‘ ì‹œ ìˆ˜í–‰)",
        "automation.group.trigger": "íŠ¸ë¦¬ê±° ë¡œê·¸ ë¬¸ìì—´",
        "automation.group.post": "ì‚¬í›„ ëª…ë ¹ (íŠ¸ë¦¬ê±°+ì§€ì—° í›„ ìˆ˜í–‰)",
        "automation.label.name": "ëª…ë ¹ ì´ë¦„:",
        "automation.label.interval": "ëª…ë ¹ì–´ ê°„ê²©:",
        "automation.label.delay": "ê°ì§€ í›„ ì§€ì—°:",
        "automation.placeholder.name": "ì˜ˆ: ë„¤íŠ¸ì›Œí¬ ì—°ê²°",
        "automation.placeholder.commands": "ëª…ë ¹ì–´ ì…ë ¥ (ì—¬ëŸ¬ ì¤„ ê°€ëŠ¥)",
        "automation.placeholder.trigger": "ê°ì§€í•  ë¡œê·¸ ì…ë ¥",
        "automation.tooltip.interval": "ì—¬ëŸ¬ ì¤„ì˜ ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•  ë•Œ, ê° ì¤„ ì‚¬ì´ì˜ ì§€ì—° ì‹œê°„",
        "automation.button.cancel": "ì·¨ì†Œ",
        "automation.button.ok": "í™•ì¸",
        "automation.default_name": "ì´ë¦„ ì—†ìŒ",
        "sidebar.tooltip.connect": "ì—°ê²°",
        "sidebar.tooltip.disconnect": "ì—°ê²° í•´ì œ",
        "sidebar.tooltip.clear_terminal": "í„°ë¯¸ë„ í´ë¦¬ì–´",
        "sidebar.tooltip.auto_manage": "ìë™ ëª…ë ¹ ì¶”ê°€/ê´€ë¦¬",
        "sidebar.tooltip.refresh_ports": "í¬íŠ¸ ìƒˆë¡œê³ ì¹¨",
        "sidebar.tooltip.copy_log_path": "ë¡œê·¸ íŒŒì¼ ê²½ë¡œ ë³µì‚¬",
        "sidebar.tooltip.copy_stats_path": "í†µê³„ íŒŒì¼ ê²½ë¡œ ë³µì‚¬",
        "sidebar.tooltip.reset_counter": "í†µê³„ ì´ˆê¸°í™”",
        "sidebar.tooltip.reset_all": "ë¬¸ìì—´ í†µê³„ ì „ì²´ í•­ëª© ì´ˆê¸°í™”",
        "sidebar.conn.expanded": "ì—°ê²° ì„¤ì • â–¼",
        "sidebar.conn.collapsed": "ì—°ê²° ì„¤ì • â–²",
        "sidebar.group.log": "ë¡œê·¸ íŒŒì¼",
        "sidebar.group.stats": "ë¬¸ìì—´ í†µê³„",
        "sidebar.group.auto": "ìë™ ëª…ë ¹ ì •ë³´",
        "sidebar.checkbox.case_sensitive": "ëŒ€ì†Œë¬¸ì êµ¬ë¶„",
        "sidebar.button.reset_all": "ì „ì²´ ì´ˆê¸°í™”",
        "sidebar.label.log_started": "ë¡œê¹… ì‹œì‘ ì‹œê°„: {timestamp}",
        "sidebar.label.log_started_empty": "ë¡œê¹… ì‹œì‘ ì‹œê°„: -",
        "sidebar.counter.placeholder": "ë¬¸ìì—´ {index}",
        "sidebar.counter.count": "Count: {count}",
        "sidebar.counter.start": "Start: {timestamp}",
        "sidebar.counter.start_empty": "Start: -",
        "sidebar.counter.state_on": "ON",
        "sidebar.counter.state_off": "OFF",
        "sidebar.button.start": "Start",
        "sidebar.button.stop": "Stop",
        "sidebar.button.delete": "ì‚­ì œ",
        "sidebar.port_not_found": "í¬íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ",
        "sidebar.dialog.load.title": "ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°",
        "sidebar.dialog.load.prompt": "í™˜ê²½ ë³€ìˆ˜(.env)ì— ì‚¬ì „ ì„¤ì •ëœ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n\n",
        "sidebar.dialog.load.stats": "â€¢ ë¬¸ìì—´ í†µê³„: {count}ê°œ\n",
        "sidebar.dialog.load.autos": "â€¢ ìë™ ëª…ë ¹: {count}ê°œ\n",
        "sidebar.dialog.add_failed.title": "ì¶”ê°€ ì‹¤íŒ¨",
        "sidebar.dialog.add_failed.body": "ìë™ ëª…ë ¹ì€ ìµœëŒ€ {max_count}ê°œê¹Œì§€ë§Œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        "sidebar.csv.header.keyword": "ë¬¸ìì—´",
        "sidebar.csv.header.timestamp": "ì§‘ê³„ ì‹œì ",
        "sidebar.csv.header.count": "ëˆ„ì  ì¹´ìš´íŠ¸",
        "sidebar.csv.header.case": "ëŒ€ì†Œë¬¸ì êµ¬ë¶„",
        "sidebar.csv.header.log": "ë¡œê·¸",
        "sidebar.csv.case_yes": "ì˜ˆ",
        "sidebar.csv.case_no": "ì•„ë‹ˆì˜¤",
    },
    "en": {
        "app.title": "LnxTerm - Serial Terminal",
        "command.placeholder": "Enter command... (Press Enter to send)",
        "menu.file": "&File",
        "menu.edit": "&Edit",
        "menu.view": "&View",
        "menu.help": "&Help",
        "menu.language": "Language",
        "action.log_start": "Start Logging...",
        "action.log_stop": "Stop Logging",
        "action.update_env": "Update Environment",
        "action.exit": "E&xit",
        "action.find": "&Find",
        "action.clear_terminal": "Clear Terminal",
        "action.toggle_sidebar": "Toggle Sidebar",
        "action.refresh_ports": "Refresh Ports",
        "action.about": "About LnxTerm",
        "action.lang_ko": "Korean",
        "action.lang_en": "English",
        "button.send": "Send",
        "status.disconnected": "âš« Disconnected",
        "status.connected": "ğŸŸ¢ Connected",
        "status.reconnecting": "ğŸŸ¡ Reconnect Pending",
        "msg.app_started": "LnxTerm serial terminal started.",
        "msg.log_dir": "Log directory: {path}",
        "msg.log_dir_not_set": "Log directory is not set. It will be requested on connect.",
        "msg.reconnect_interval": "Auto reconnect interval: {interval}",
        "msg.env_path": ".env path: {path}",
        "msg.select_port": "Select a port in the sidebar and connect.\n",
        "msg.port_in_use_warning_terminal": "âš ï¸  Warning: {port} is used by:\n{procs}\n",
        "dialog.port_in_use.title": "Port In Use",
        "dialog.port_in_use.body": "{port} is already in use:\n\n{procs}\n\nDo you still want to connect?",
        "msg.connect_canceled": "Connection canceled.\n",
        "msg.connected": "Connected: {port} @ {baudrate} bps\n",
        "dialog.connect_error.title": "Connection Error",
        "dialog.connect_error.body": "Failed to connect to serial port:\n{error}",
        "msg.connect_failed": "Connection failed: {error}\n",
        "dialog.select_log_dir": "Select Log Directory",
        "msg.log_dir_required": "A log directory is required before connecting.\n",
        "msg.log_dir_set": "Log directory set: {path}\n",
        "time.seconds.integer": "{value}s",
        "time.seconds.float": "{value:g}s",
        "msg.disconnected": "Disconnected: {port}\n",
        "msg.auto_reconnect_after": "Auto reconnect in {delay}...\n",
        "msg.reconnect_trying": "Trying to reconnect...\n",
        "msg.reconnect_failed": "Reconnect failed. Retrying in {delay}...\n",
        "msg.error_prefix": "Error: {error}\n",
        "msg.port_not_connected": "Port is not connected.\n",
        "msg.send_error": "Send error: {error}\n",
        "msg.send_error_delayed": "Send error (delayed send): {error}\n",
        "msg.log_start": "Logging started: {path}\n",
        "dialog.log_error.title": "Log Error",
        "dialog.log_error.body": "Cannot open log file:\n{error}",
        "msg.log_stop": "Logging stopped: {path}\n",
        "msg.terminal_cleared": "Terminal was cleared.\n",
        "about.title": "About LnxTerm",
        "about.body": (
            "<h3>LnxTerm Serial Terminal</h3>"
            "<p>Version: {version}</p>"
            "<p>Serial terminal for ST-Link V3 Mini based<br>"
            "embedded device debugging and log collection</p>"
            "<p><b>Features:</b></p>"
            "<ul>"
            "<li>Serial port connection and command send</li>"
            "<li>Logging with millisecond timestamps</li>"
            "<li>Terminal output search</li>"
            "</ul>"
        ),
        "msg.env_updated": "Environment variables (.env) updated.\n",
        "dialog.done.title": "Done",
        "dialog.done.body": "Environment variables (.env) were updated successfully.",
        "dialog.update_unavailable.title": "Update Unavailable",
        "dialog.update_unavailable.body": "Cannot update environment variables because AUTO_LOAD_MODE is '{mode}'.",
        "dialog.failed.title": "Failed",
        "dialog.failed.body": "Failed to update environment variables. (Unknown error)",
        "search.placeholder": "Search...",
        "search.tooltip.prev": "Previous result (Shift+F3)",
        "search.tooltip.next": "Next result (F3)",
        "search.tooltip.close": "Close (Esc)",
        "search.no_results": "No results",
        "automation.title": "Automatic Command Setup",
        "automation.group.basic": "Automatic Command Basics",
        "automation.group.pre": "Pre Command (Run on Start)",
        "automation.group.trigger": "Trigger Log String",
        "automation.group.post": "Post Command (Run after Trigger+Delay)",
        "automation.label.name": "Command name:",
        "automation.label.interval": "Command interval:",
        "automation.label.delay": "Delay after detection:",
        "automation.placeholder.name": "e.g. Network Connect",
        "automation.placeholder.commands": "Enter commands (multi-line supported)",
        "automation.placeholder.trigger": "Enter trigger log text",
        "automation.tooltip.interval": "Delay between each line when running multi-line commands",
        "automation.button.cancel": "Cancel",
        "automation.button.ok": "OK",
        "automation.default_name": "Untitled",
        "sidebar.tooltip.connect": "Connect",
        "sidebar.tooltip.disconnect": "Disconnect",
        "sidebar.tooltip.clear_terminal": "Clear Terminal",
        "sidebar.tooltip.auto_manage": "Add/Manage Auto Commands",
        "sidebar.tooltip.refresh_ports": "Refresh Ports",
        "sidebar.tooltip.copy_log_path": "Copy log file path",
        "sidebar.tooltip.copy_stats_path": "Copy stats file path",
        "sidebar.tooltip.reset_counter": "Reset stats",
        "sidebar.tooltip.reset_all": "Reset all string stats",
        "sidebar.conn.expanded": "Connection Settings â–¼",
        "sidebar.conn.collapsed": "Connection Settings â–²",
        "sidebar.group.log": "Log File",
        "sidebar.group.stats": "String Statistics",
        "sidebar.group.auto": "Auto Command Info",
        "sidebar.checkbox.case_sensitive": "Case sensitive",
        "sidebar.button.reset_all": "Reset All",
        "sidebar.label.log_started": "Logging started: {timestamp}",
        "sidebar.label.log_started_empty": "Logging started: -",
        "sidebar.counter.placeholder": "String {index}",
        "sidebar.counter.count": "Count: {count}",
        "sidebar.counter.start": "Start: {timestamp}",
        "sidebar.counter.start_empty": "Start: -",
        "sidebar.counter.state_on": "ON",
        "sidebar.counter.state_off": "OFF",
        "sidebar.button.start": "Start",
        "sidebar.button.stop": "Stop",
        "sidebar.button.delete": "Del",
        "sidebar.port_not_found": "No ports found",
        "sidebar.dialog.load.title": "Load Preset Configs",
        "sidebar.dialog.load.prompt": "Preset data exists in .env. Do you want to load it?\n\n",
        "sidebar.dialog.load.stats": "â€¢ String stats: {count}\n",
        "sidebar.dialog.load.autos": "â€¢ Auto commands: {count}\n",
        "sidebar.dialog.add_failed.title": "Cannot Add",
        "sidebar.dialog.add_failed.body": "You can register up to {max_count} automatic commands.",
        "sidebar.csv.header.keyword": "Keyword",
        "sidebar.csv.header.timestamp": "Timestamp",
        "sidebar.csv.header.count": "Cumulative Count",
        "sidebar.csv.header.case": "Case Sensitive",
        "sidebar.csv.header.log": "Log",
        "sidebar.csv.case_yes": "Yes",
        "sidebar.csv.case_no": "No",
    },
}


def tr(language: str | None, key: str, **kwargs) -> str:
    normalized = normalize_language(language)
    text = TRANSLATIONS[normalized].get(key)
    if text is None:
        text = TRANSLATIONS["ko"].get(key, key)
    if kwargs:
        return text.format(**kwargs)
    return text
